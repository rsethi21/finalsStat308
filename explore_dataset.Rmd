---
title: "project"
author: "Rohan Sethi"
date: "`r Sys.Date()`"
output: html_document
---

# Open Data
```{r}
setwd("path/to/data/folder")
data <- read.csv("Breast_cancer.csv")
```

# Load Libraries
```{r}
library("tidyverse")
library("ggplot2")
library(leaps)
```

# Data Engineering
```{r}
new_col = data$Reginol.Node.Positive/data$Regional.Node.Examined
data$rate = new_col
columns_to_remove = c("T.Stage", "X6th.Stage","differentiate", "Regional.Node.Postive")
filtered_data = select(data, -columns_to_remove)
head(filtered_data)
```
# Analyze Interactions
```{r}
ys = c("rate","Survival.Months","Age","Progesterone.Status", "Estrogen.Status", "A.Stage", "Race", "Marital.Status", "Grade", "N.Stage","Status")
colors = c("Progesterone.Status", "Estrogen.Status", "A.Stage", "Race", "Marital.Status", "Grade", "N.Stage","Status")

for (y in ys){
  for (c in colors){
    if (y != c){
    ggplot(aes(x=!!sym(y), y=Tumor.Size, color=!!sym(c)), data=filtered_data) + geom_point() + geom_smooth(method="lm")
    ggsave(paste(paste(y, c), ".png"))
    }
  }
}
```


# Basic Model
## No Transformation
```{r}
bm <- "Tumor.Size ~ ."
basic_model <- lm(as.formula(bm), filtered_data)
summary(basic_model)
plot(basic_model, 1)
plot(basic_model, 2)
```
## Log Model
```{r}
ml <- "log(Tumor.Size)~."
model_log <- lm(as.formula(ml), filtered_data)
summary(model_log)
plot(model_log, 1)
plot(model_log, 2)
```

## Model Sqrt
```{r}
ms <- "sqrt(Tumor.Size)~."
model_sqrt <- lm(as.formula(ms), filtered_data)
summary(model_sqrt)
plot(model_sqrt, 1)
plot(model_sqrt, 2)
```
## Sqrt-Log Basic
```{r}
slb <- "sqrt(log(Tumor.Size)) ~ ."
slb_model <- lm(as.formula(slb), filtered_data)
summary(slb_model)
plot(slb_model, 1)
plot(slb_model, 2)
```
## Log-Sqrt Basic
```{r}
lsb <- "log(sqrt(Tumor.Size)) ~ ."
lsb_model <- lm(as.formula(lsb), filtered_data)
summary(lsb_model)
plot(lsb_model, 1)
plot(lsb_model, 2)
```


# Selected Interactions Model
## No Transformation
```{r}
mp <- "Tumor.Size ~ . + A.Stage:N.Stage + A.Stage:Status + A.Stage:Age + Grade:Age + Age:N.Stage + Age:Status + Estrogen.Status:Grade + Progesterone.Status:Estrogen.Status + A.Stage:Grade + A.Stage:N.Stage + A.Stage:rate + Grade:rate + N.Stage:rate + Status:rate + A.Stage:Survival.Months + Estrogen.Status + Survival.Months + Grade:Survival.Months + N.Stage:Survival.Months + Status:Survival.Months"
model_picked <- lm(as.formula(mp), filtered_data) # .*. for all interactions possible
summary(model_picked)
plot(model_picked, 1)
plot(model_picked, 2)
```
## Log Picked Interactions
```{r}
lmp <- "log(Tumor.Size) ~ . + A.Stage:N.Stage + A.Stage:Status + A.Stage:Age + Grade:Age + Age:N.Stage + Age:Status + Estrogen.Status:Grade + Progesterone.Status:Estrogen.Status + A.Stage:Grade + A.Stage:N.Stage + A.Stage:rate + Grade:rate + N.Stage:rate + Status:rate + A.Stage:Survival.Months + Estrogen.Status + Survival.Months + Grade:Survival.Months + N.Stage:Survival.Months + Status:Survival.Months"
log_model_picked <- lm(as.formula(lmp), filtered_data) # .*. for all interactions possible
summary(log_model_picked)
plot(log_model_picked, 1)
plot(log_model_picked, 2)
```
## Sqrt Picked Model
```{r}
smp <- "sqrt(Tumor.Size) ~ . + A.Stage:N.Stage + A.Stage:Status + A.Stage:Age + Grade:Age + Age:N.Stage + Age:Status + Estrogen.Status:Grade + Progesterone.Status:Estrogen.Status + A.Stage:Grade + A.Stage:N.Stage + A.Stage:rate + Grade:rate + N.Stage:rate + Status:rate + A.Stage:Survival.Months + Estrogen.Status + Survival.Months + Grade:Survival.Months + N.Stage:Survival.Months + Status:Survival.Months"
sqrt_model_picked <- lm(as.formula(smp), filtered_data) # .*. for all interactions possible
summary(sqrt_model_picked)
plot(sqrt_model_picked, 1)
plot(sqrt_model_picked, 2)
```
## Sqrt-Log Picked
```{r}
slp <- "sqrt(log(Tumor.Size)) ~ . + A.Stage:N.Stage + A.Stage:Status + A.Stage:Age + Grade:Age + Age:N.Stage + Age:Status + Estrogen.Status:Grade + Progesterone.Status:Estrogen.Status + A.Stage:Grade + A.Stage:N.Stage + A.Stage:rate + Grade:rate + N.Stage:rate + Status:rate + A.Stage:Survival.Months + Estrogen.Status + Survival.Months + Grade:Survival.Months + N.Stage:Survival.Months + Status:Survival.Months"
slp_model <- lm(as.formula(slp), filtered_data)
summary(slp_model)
plot(slp_model, 1)
plot(slp_model, 2)
```
## Log Sqrt Picked
```{r}
lsp <- "log(sqrt(Tumor.Size)) ~ . + A.Stage:N.Stage + A.Stage:Status + A.Stage:Age + Grade:Age + Age:N.Stage + Age:Status + Estrogen.Status:Grade + Progesterone.Status:Estrogen.Status + A.Stage:Grade + A.Stage:N.Stage + A.Stage:rate + Grade:rate + N.Stage:rate + Status:rate + A.Stage:Survival.Months + Estrogen.Status + Survival.Months + Grade:Survival.Months + N.Stage:Survival.Months + Status:Survival.Months"
lsp_model <- lm(as.formula(lsp), filtered_data)
summary(lsp_model)
plot(lsp_model, 1)
plot(lsp_model, 2)
```



# Model Selection
```{r}
models <- c(ml, ms, bm, slb, lsb, mp, lmp, smp, slp, lsp)
nmaxes <- c(length(filtered_data)-1, length(filtered_data)-1, length(filtered_data)-1, length(filtered_data)-1, length(filtered_data)-1, length(filtered_data)-1+20, length(filtered_data)-1+20, length(filtered_data)-1+20, length(filtered_data)-1+20, length(filtered_data)-1+20)
best_model <- none
best_score <- 0
best_index <- 0

for (i in seq_along(models)) {
  print(i)
  selected_models <- regsubsets(as.formula(models[i]), data=filtered_data, nvmax=nmaxes[i], method="seqrep")
  score <- summary(selected_models)$adjr2[which.max(summary(selected_models)$adjr2)]
  if (score > best_score) {
    best_model <- coef(selected_models, which.max(summary(selected_models)$adjr2))
    best_score <- summary(selected_models)$adjr2[which.max(summary(selected_models)$adjr2)]
    best_index = i
  }
}
```

```{r}
print(length(best_model))
print(best_score)
print(models[best_index])
```
